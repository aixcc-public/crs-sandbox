######################################
# COMPETITORS: DO NOT MODIFY THIS FILE
######################################

services:
  iapi:
    profiles:
      - development
      - competition
    image: ghcr.io/aixcc-sc/iapi:v1.0.0
    restart: always
    ports:
      - "8080:80"
    healthcheck:
      test: ["CMD-SHELL", "wget -O /dev/null http://localhost || exit 1"]
      timeout: 10s
    volumes:
      - type: volume
        source: cp_root
        target: /cp_root
        read_only: false
    environment:
      - AIXCC_API_HOSTNAME="https://api.aixcc.internal"
  db:
    profiles:
      - development
    image: postgres:16.2-alpine3.19
    restart: always
    shm_size: 128mb
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=aixcc
      - POSTGRES_USER=aixcc
      - POSTGRES_PORT=5432
      - POSTGRES_DATABASE=litellm
  litellm:
    profiles:
      - development
    image: ghcr.io/berriai/litellm-database:main-v1.35.10
    restart: always
    volumes:
      - ./litellm/local_litellm_config.yaml:/app/config.yaml
      - ./litellm/vertex_key.json:/vertex_key.json
    command: [ "--config", "/app/config.yaml", "--port", "80", "--num_workers", "8" ]
    ports:
      - "8081:80"
    env_file: .env
    environment:
      - DATABASE_URL=postgresql://aixcc:aixcc@db
    healthcheck:
      test: ["CMD-SHELL", "python3", "--version"]
      interval: 5s
      timeout: 5s
      retries: 10
      start_period: 1s
volumes:
  cp_root:
